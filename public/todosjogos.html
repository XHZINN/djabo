<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Todos os Jogos</title>
    <link rel="stylesheet" href="atributos/css/style.css">
</head>
<body>
    <main class="principal-conteudo">
        <h2>Popular</h2>
        <!-- carrosel-->
        <section class="carrosel">
            <!-- seta esquerda -->
            <button class="vlt-bt">&lt;</button>

            <!-- slide -->
             <div id="jogos-container">
                <img src="" alt="">
             </div>

             <!-- Seta direita -->
              <button class="prx-bt">&gt;;</button>
        </section>
    </main>
    <script>
        async function carregarJogos() {
            const container = document.getElementById('jogos-container');
            try {
                const res = await fetch('/api/jogos');
                
                // Verifica se a resposta foi bem sucedida
                if (!res.ok) {
                    throw new Error(`Erro HTTP: ${res.status}`);
                }
                
                const jogos = await res.json();

                // Verifica se jogos é um array
                if (!Array.isArray(jogos)) {
                    console.error('Resposta não é um array:', jogos);
                    container.innerHTML = '<p>Erro ao carregar jogos</p>';
                    return;
                }

                // Se o array estiver vazio
                if (jogos.length === 0) {
                    container.innerHTML = '<p>Nenhum jogo cadastrado</p>';
                    return;
                }

                // Renderiza os jogos
                jogos.forEach(jogo => {
                    const div = document.createElement('div');
                    div.classList.add('jogo');
                    
                    // Verifica se há imagem de capa
                    const imagemSrc = jogo.cont_capa ? jogo.cont_capa.replace(/\\/g, '/') : 'placeholder.jpg';
                    
                    div.innerHTML = `
                        <img src="${imagemSrc}" alt="${jogo.nome}" onerror="this.src='placeholder.jpg'">
                        <p>${jogo.nome}</p>
                    `;
                    
                    div.addEventListener('click', () => {
                        window.location.href = `jogo.html?id=${jogo.id}`;
                    });
                    
                    container.appendChild(div);
                });
            } catch (err) {
                console.error('Erro ao carregar jogos:', err);
                container.innerHTML = '<p>Erro ao carregar jogos. Tente novamente.</p>';
            }
        }

        carregarJogos();
    </script>
</body>
</html>